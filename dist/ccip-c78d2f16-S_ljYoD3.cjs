"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const l=require("./index-021f6a62-CLrWauJy.cjs"),n=require("./transactionRequest-be6a8ea9-RcXsyD66.cjs");class g extends n.BaseError{constructor({callbackSelector:e,cause:t,data:c,extraData:i,sender:d,urls:r}){var u;super(t.shortMessage||"An error occurred while fetching for an offchain result.",{cause:t,metaMessages:[...t.metaMessages||[],(u=t.metaMessages)!=null&&u.length?"":[],"Offchain Gateway Call:",r&&["  Gateway URL(s):",...r.map(f=>`    ${n.getUrl(f)}`)],`  Sender: ${d}`,`  Data: ${c}`,`  Callback selector: ${e}`,`  Extra data: ${i}`].flat()}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"OffchainLookupError"})}}class k extends n.BaseError{constructor({result:e,url:t}){super("Offchain gateway response is malformed. Response data must be a hex value.",{metaMessages:[`Gateway URL: ${n.getUrl(t)}`,`Response: ${l.s(e)}`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"OffchainLookupResponseMalformedError"})}}class L extends n.BaseError{constructor({sender:e,to:t}){super("Reverted sender address does not match target contract address (`to`).",{metaMessages:[`Contract address: ${t}`,`OffchainLookup sender address: ${e}`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"OffchainLookupSenderMismatchError"})}}function O(a,e){if(!n.isAddress(a,{strict:!1}))throw new n.InvalidAddressError({address:a});if(!n.isAddress(e,{strict:!1}))throw new n.InvalidAddressError({address:e});return a.toLowerCase()===e.toLowerCase()}const E="0x556f1830",m={name:"OffchainLookup",type:"error",inputs:[{name:"sender",type:"address"},{name:"urls",type:"string[]"},{name:"callData",type:"bytes"},{name:"callbackFunction",type:"bytes4"},{name:"extraData",type:"bytes"}]};async function x(a,{blockNumber:e,blockTag:t,data:c,to:i}){const{args:d}=l.d({data:c,abi:[m]}),[r,u,f,s,o]=d,{ccipRead:p}=a,w=p&&typeof(p==null?void 0:p.request)=="function"?p.request:y;try{if(!O(i,r))throw new L({sender:r,to:i});const h=await w({data:f,sender:r,urls:u}),{data:b}=await l.c(a,{blockNumber:e,blockTag:t,data:n.concat([s,l.e([{type:"bytes"},{type:"bytes"}],[h,o])]),to:i});return b}catch(h){throw new g({callbackSelector:s,cause:h,data:c,extraData:o,sender:r,urls:u})}}async function y({data:a,sender:e,urls:t}){var i;let c=new Error("An unknown error occurred.");for(let d=0;d<t.length;d++){const r=t[d],u=r.includes("{data}")?"GET":"POST",f=u==="POST"?{data:a,sender:e}:void 0;try{const s=await fetch(r.replace("{sender}",e).replace("{data}",a),{body:JSON.stringify(f),method:u});let o;if((i=s.headers.get("Content-Type"))!=null&&i.startsWith("application/json")?o=(await s.json()).data:o=await s.text(),!s.ok){c=new l.H({body:f,details:o!=null&&o.error?l.s(o.error):s.statusText,headers:s.headers,status:s.status,url:r});continue}if(!n.isHex(o)){c=new k({result:o,url:r});continue}return o}catch(s){c=new l.H({body:f,details:s.message,url:r})}}throw c}exports.ccipRequest=y;exports.offchainLookup=x;exports.offchainLookupAbiItem=m;exports.offchainLookupSignature=E;
//# sourceMappingURL=ccip-c78d2f16-S_ljYoD3.cjs.map
